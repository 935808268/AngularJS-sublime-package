import sublime, sublime_plugin

isST2 = int(sublime.version()) < 3000

if isST2:
	import convert
else:
	from . import convert


class AngularjsTestPlugin(sublime_plugin.WindowCommand):

	def run(self):
		print('\nAngularJS Plug-in Test Runner Results:\n')
		self.test_element_completions()

	def test_element_completions(self):
		html_elems = [('ng-include\tAngularJS', 'ng-include src="$1"${2: scope="$3"}${4: onload="$5"}></ng-include>'), ('ng-pluralize\tAngularJS', 'ng-pluralize count="${1:string}" when="$2" offset="$4"></ng-pluralize>'), ('ng-select\tAngularJS', 'select ngModel="${1:string}"${2:${3: name="${4:string}"}${5: required}${6: ngRequired="${7:string}"}${8: ngOptions="${9:comprehension_expression}"}}>$10</select>$0'), ('ng-template\tAngularJS', 'script type="text/ng-template"${1: id="$2"}>$0</script>'), ('ng-textarea\tAngularJS', 'textarea ngModel="${1:string}"${2:${3: name="${4:string}"}${5: required}${6: ngRequired="${7:string}"}${8: ngMinlength="${9:number}"}${10: ngMaxlength="${11:number}"}${12: ngPattern="${13:string}"}${14: ngChange="${15:string}"}}>$16</textarea>$0'), ('ng-view\tAngularJS', 'ng-view></ng-view>')]
		expect_jade_elems = [('ng-include\tAngularJS', 'ng-include(src="$1"${2: , scope="$3"}${4: , onload="$5"})'), ('ng-pluralize\tAngularJS', 'ng-pluralize(count="${1:string}" , when="$2" , offset="$4")'), ('ng-select\tAngularJS', 'select(ngModel="${1:string}"${2:${3: , name="${4:string}"}${5: required}${6: , ngRequired="${7:string}"}${8: , ngOptions="${9:comprehension_expression}"}})$10$0'), ('ng-template\tAngularJS', 'script(type="text/ng-template"${1: , id="$2"})$0'), ('ng-textarea\tAngularJS', 'textarea(ngModel="${1:string}"${2:${3: , name="${4:string}"}${5: required}${6: , ngRequired="${7:string}"}${8: , ngMinlength="${9:number}"}${10: , ngMaxlength="${11:number}"}${12: , ngPattern="${13:string}"}${14: , ngChange="${15:string}"}})$16$0'), ('ng-view\tAngularJS', 'ng-view()')]
		expect_haml_elems = [('ng-include\tAngularJS', '%ng-include{src="$1"${2: , scope="$3"}${4: , onload="$5"}}'), ('ng-pluralize\tAngularJS', '%ng-pluralize{count="${1:string}" , when="$2" , offset="$4"}'), ('ng-select\tAngularJS', '%select{ngModel="${1:string}"${2:${3: , name="${4:string}"}${5: required}${6: , ngRequired="${7:string}"}${8: , ngOptions="${9:comprehension_expression}"}}}$10$0'), ('ng-template\tAngularJS', '%script{type="text/ng-template"${1: , id="$2"}}$0'), ('ng-textarea\tAngularJS', '%textarea{ngModel="${1:string}"${2:${3: , name="${4:string}"}${5: required}${6: , ngRequired="${7:string}"}${8: , ngMinlength="${9:number}"}${10: , ngMaxlength="${11:number}"}${12: , ngPattern="${13:string}"}${14: , ngChange="${15:string}"}}}$16$0'), ('ng-view\tAngularJS', '%ng-view{}')]

		jade = [(elem[0], convert.completionToJadeElement(elem[1])) for elem in html_elems]
		haml = [(elem[0], convert.completionToHamlElement(elem[1])) for elem in html_elems]

		print('[Element Completions - Jade]\tpassed: %s' % (jade == expect_jade_elems))
		print('[Element Completions - haml]\tpassed: %s' % (haml == expect_haml_elems))

	def test_attribute_completions(self):
		html_attrs = [('ng-app\tAngularJS', 'ng-app="${1:string}"$0'), ('ng-bind\tAngularJS', 'ng-bind="${1:expression}"$0'), ('ng-bind-html\tAngularJS', 'ng-bind-html="${1:expression}"$0'), ('ng-bind-html-unsafe\tAngularJS', 'ng-bind-html-unsafe="${1:expression}"$0'), ('ng-bind-template\tAngularJS', 'ng-bind-template="${1:string}"$0'), ('ng-blur\tAngularJS', 'ng-blur="${1:expression}"$0'), ('ng-change\tAngularJS', 'ng-change="${1:function()}"$0'), ('ng-checked\tAngularJS', 'ng-checked="${1:expression}"$0'), ('ng-class\tAngularJS', 'ng-class="${1:expression}"$0'), ('ng-class-even\tAngularJS', 'ng-class-even="${1:expression}"$0'), ('ng-class-odd\tAngularJS', 'ng-class-odd="${1:expression}"$0'), ('ng-click\tAngularJS', 'ng-click="${1:expression}"$0'), ('ng-cloak\tAngularJS', 'ng-cloak$0'), ('ng-controller\tAngularJS', 'ng-controller="$1"$2'), ('ng-copy\tAngularJS', 'ng-copy="${1:expression}"$0'), ('ng-csp\tAngularJS', 'ng-csp$0'), ('ng-cut\tAngularJS', 'ng-cut="${1:expression}"$0'), ('ng-dblclick\tAngularJS', 'ng-dblclick="${1:expression}"$0'), ('ng-disabled\tAngularJS', 'ng-disabled="${1:expression}"$0'), ('ng-focus\tAngularJS', 'ng-focus="${1:expression}"$0'), ('ng-form\tAngularJS', 'ng-form name="${1:string}"$0'), ('ng-hide\tAngularJS', 'ng-hide="${1:expression}"$0'), ('ng-href\tAngularJS', 'ng-href="${1:template}"$0'), ('ng-if\tAngularJS', 'ng-if="${1:expression}"$0'), ('ng-include\tAngularJS', 'ng-include="${1:string}" ${2:scope="$3"} ${4:onload="$5"}'), ('ng-init\tAngularJS', 'ng-init="${1:expression}"$0'), ('ng-keydown\tAngularJS', 'ng-keydown="${1:expression}"$0'), ('ng-keypress\tAngularJS', 'ng-keypress="${1:expression}"$0'), ('ng-keyup\tAngularJS', 'ng-keyup="${1:expression}"$0'), ('ng-list\tAngularJS', 'ng-list="${1:string}"$0'), ('ng-model\tAngularJS', 'ng-model$0'), ('ng-mousedown\tAngularJS', 'ng-mousedown="${1:expression}"$0'), ('ng-mouseenter\tAngularJS', 'ng-mouseenter="${1:expression}"$0'), ('ng-mouseleave\tAngularJS', 'ng-mouseleave="${1:expression}"$0'), ('ng-mousemove\tAngularJS', 'ng-mousemove="${1:expression}"$0'), ('ng-mouseover\tAngularJS', 'ng-mouseover="${1:expression}"$0'), ('ng-mouseup\tAngularJS', 'ng-mouseup="${1:expression}"$0'), ('ng-multiple\tAngularJS', 'ng-multiple="${1:expression}"$0'), ('ng-non-bindable\tAngularJS', 'ng-non-bindable$0'), ('ng-open\tAngularJS', 'ng-open="${1:expression}"$0'), ('ng-paste\tAngularJS', 'ng-paste="${1:expression}"$0'), ('ng-options\tAngularJS', 'ng-options="${1:select} as ${2:label} for ${3:value} in ${4:array}"'), ('ng-pluralize\tAngularJS', 'ng-pluralize count="${1:string}" when="$2" offset="$4"$0'), ('ng-readonly\tAngularJS', 'ng-readonly="${1:expression}"$0'), ('ng-repeat\tAngularJS', 'ng-repeat="${1:(${2:key}, ${3:value})} in ${4:dataset}"$0'), ('ng-repeat-end\tAngularJS', 'ng-repeat-end$0'), ('ng-repeat-start\tAngularJS', 'ng-repeat-start="${1:(${2:key}, ${3:value})} in ${4:dataset}"$0'), ('ng-selected\tAngularJS', 'ng-selected="${1:string}"$0'), ('ng-show\tAngularJS', 'ng-show="${1:expression}"$0'), ('ng-src\tAngularJS', 'ng-src="${1:template}"$0'), ('ng-srcset\tAngularJS', 'ng-srcset="${1:template}"$0'), ('ng-style\tAngularJS', 'ng-style="${1:expression}"$0'), ('ng-submit\tAngularJS', 'ng-submit="${1:expression}"$0'), ('ng-swipe-left\tAngularJS', 'ng-swipe-left="${1:expression}"$0'), ('ng-swipe-right\tAngularJS', 'ng-swipe-right="${1:expression}"$0'), ('ng-switch\tAngularJS', 'ng-switch on="${1:expression}"$0'), ('ng-switch-when\tAngularJS', 'ng-switch-when="${1:string}"$0'), ('ng-switch-default\tAngularJS', 'ng-switch-default$0'), ('ng-transclude\tAngularJS', 'ng-transclude$0'), ('ng-trim\tAngularJS', 'ng-trim$0'), ('ng-value\tAngularJS', 'ng-value="${1:string}"$0'), ('ng-view\tAngularJS', 'ng-view$0')]
